import { readFiles } from "../../utils/fileUtils";
import Link from "next/link";
import Wrapper from "../../components/Wrapper";
import MaxWidthWrapper from "../../components/MaxWidthWrapper";
import matter from "gray-matter";

export async function getStaticProps() {
  const frontMatters = [];
  await readFiles("Blog").then((files) => {
    files.forEach((post) => {
      let fm = matter(post.contents);

      // date is date object, fix this by modifying frontmatter config in forestry
      let newFMData = { ...fm.data };
      newFMData.filename = post.filename;
      newFMData.creation_date = fm.data.creation_date.getTime();
      frontMatters.push(newFMData);
      console.log(newFMData);
    });
  });

  return {
    props: {
      frontMatterData: frontMatters,
    },
  };
}

// linear-gradient(
// 180deg
// , transparent, rgba(255,255,255,0.5)), linear-gradient(to top right, var(--tw-gradient-stops));

const Blog = ({ className, ...props }) => {
  // call it file meta data or something and also have title (slug)
  const fm = props.frontMatterData;

  return (
    <main className={` ${className} relative py-24`}>
      <div className="hidden xl:block absolute top-52 transform scale-150 opacity-10 -rotate-90 text-neutral z-0">
        <svg
          width="100%"
          viewBox="0 0 1440 600"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            className="fill-current text-gray-900 z-0"
            fillRule="evenodd"
            d="M1322 150 1412.5 150 1412.5 371.5Q1412.5 447 1371.5 484.75Q1336.806 516.694 1276.335 521.607A282.112 282.112 0 011253.5 522.5A315.162 315.162 0 011200.863 518.246A271.999 271.999 0 011178.5 513.5A205.397 205.397 0 011146.59 502.582A155.28 155.28 0 011119 487L1153.5 420.5A104.524 104.524 0 001173.501 433.221Q1183.104 437.964 1194.512 441.522A172.038 172.038 0 001195.25 441.75Q1220.5 449.5 1245 449.5Q1267.339 449.5 1282.58 443.645A52.458 52.458 0 001300 433A52.188 52.188 0 001313.907 410.168Q1316.546 401.766 1317.246 391.592A110.493 110.493 0 001317.5 384L1317.5 375A88.38 88.38 0 011270.424 403.219Q1256.169 406.764 1239.266 406.985A172.867 172.867 0 011237 407Q1201 407 1170.5 390.75Q1140 374.5 1122 344.75A124.861 124.861 0 011104.877 292.764A156.805 156.805 0 011104 276A140.298 140.298 0 011109.383 236.508A120.596 120.596 0 011122 207.75Q1140 178 1170.5 161.75Q1201 145.5 1237 145.5A141.123 141.123 0 011270.034 149.116Q1303.385 157.146 1322 183L1322 150ZM347 394 347 421 256.5 421 256.5 50 351.5 50 351.5 173.5A90.803 90.803 0 01397.707 148.515A134.719 134.719 0 01427 145.5Q464 145.5 494.25 162.5Q524.5 179.5 542.25 211.25A138.652 138.652 0 01558.267 259.751A178.302 178.302 0 01560 285Q560 327 542.25 359Q524.5 391 494.25 408.25A132.58 132.58 0 01430.454 425.462A156.73 156.73 0 01427 425.5A144.385 144.385 0 01396.199 422.424Q365.219 415.656 347 394ZM0 471 165 0 249.5 0 84.5 471 0 471ZM604 326 604 50 699 50 699 321A46.472 46.472 0 00699.815 329.991Q701.513 338.594 706.75 344A25.346 25.346 0 00719.199 350.956Q723.176 351.935 727.871 351.996A48.265 48.265 0 00728.5 352Q740 352 750 347L754 418.5Q732.5 425.5 709.5 425.5Q670.914 425.5 645.578 410.164A84.91 84.91 0 01631.75 399.75A83.345 83.345 0 01607.741 358.25Q604 343.625 604 326ZM875.34 419.154A180.993 180.993 0 00924 425.5Q968 425.5 1003 407.5Q1038 389.5 1057.5 357.5A130.121 130.121 0 001069.759 331.203A143.983 143.983 0 001077 285A161.765 161.765 0 001076.695 275.012A132.689 132.689 0 001057.5 212.75A131.198 131.198 0 001046.781 197.75A135.543 135.543 0 001003 163.25A158.099 158.099 0 00970.652 151.116A187.244 187.244 0 00924 145.5A201.864 201.864 0 00901.927 146.68A162.514 162.514 0 00845.25 163.25Q810.5 181 790.75 213A130.392 130.392 0 00779.915 234.861A138.923 138.923 0 00771 285Q771 325.5 790.75 357.5Q810.5 389.5 845.5 407.5A156.971 156.971 0 00875.34 419.154ZM407 350A59.063 59.063 0 00427.727 346.489A52.226 52.226 0 00448 332.75Q462.945 316.637 463.93 288.963A111.412 111.412 0 00464 285Q464 255 448 238A53.269 53.269 0 00409.707 221.051A71.422 71.422 0 00407 221A59.971 59.971 0 00386.519 224.371A52.246 52.246 0 00366 238Q350 255 350 285Q350 315.5 366 332.75A52.99 52.99 0 00404.676 349.962A70.677 70.677 0 00407 350ZM924 350A59.063 59.063 0 00944.727 346.489A52.226 52.226 0 00965 332.75Q979.945 316.637 980.93 288.963A111.412 111.412 0 00981 285Q981 255 965 238A53.269 53.269 0 00926.707 221.051A71.422 71.422 0 00924 221A59.971 59.971 0 00903.519 224.371A52.246 52.246 0 00883 238Q867 255 867 285Q867 315.5 883 332.75A52.99 52.99 0 00921.676 349.962A70.677 70.677 0 00924 350ZM1259.5 331.5A68.849 68.849 0 001280.053 328.56A56.126 56.126 0 001301.75 316A51.419 51.419 0 001318.435 279.027A69.286 69.286 0 001318.5 276A59.101 59.101 0 001315.563 256.974A49.416 49.416 0 001302 236.25A56.641 56.641 0 001271.351 221.866A78.278 78.278 0 001259.5 221A72.58 72.58 0 001239.555 223.615A56.306 56.306 0 001216.75 236.25A50.463 50.463 0 001200.102 272.228A68.632 68.632 0 001200 276A57.573 57.573 0 001203.254 295.715A50.368 50.368 0 001217 316Q1234 331.5 1259.5 331.5"
          ></path>
        </svg>
      </div>

      <MaxWidthWrapper>
        <div className="text-xl">
          <ul className="flex flex-col w-full">
            {fm.map((item, index) => {
              return (
                <div key={index}>
                  {console.log(item)}
                  <Link
                    href={`/blog/post/${item.filename
                      .split(".")
                      .slice(0, -1)
                      .join(".")}`}
                  >
                    <a>
                      {item.title} --{" "}
                      {new Date(item.creation_date).toLocaleDateString(
                        "en-IN",
                        {
                          year: "numeric",
                          month: "short",
                          day: "numeric",
                        }
                      )}
                    </a>
                  </Link>
                </div>
              );
            })}
          </ul>
        </div>
      </MaxWidthWrapper>
    </main>
  );
};

export default Blog;
